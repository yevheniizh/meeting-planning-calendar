(self.webpackChunk=self.webpackChunk||[]).push([[849],{579:(e,t,n)=>{"use strict";n.d(t,{Z:()=>s});const s=(e="API response: succesful",t)=>{const n=`\n    <div class="toast calendar__toast_${t} align-items-center" role="alert" aria-live="assertive" aria-atomic="true">\n      <div class="d-flex">\n        <div class="toast-body">\n          ${e}\n        </div>\n      </div>\n    </div>`,s=document.querySelector(".toast-container"),a=document.createElement("div");a.innerHTML=n;const i=a.firstElementChild;s.appendChild(i);const l=s.lastElementChild;new bootstrap.Toast(l,{animation:!0,autohide:!0,delay:2e3}).show(),setTimeout((()=>{s.firstElementChild.remove()}),2e3)}},330:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>c});var s=n(579);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class i extends class{constructor(e,t){a(this,"element",void 0),a(this,"subElements",{}),a(this,"start",10),a(this,"end",18),a(this,"duration",1),a(this,"onRemoveMeetingClick",(async e=>{const t=e.target.closest("[data-meeting]"),n=t.dataset.meeting,a=t.dataset.name;if(confirm(`Are you sure you want to delete '${a}' event?`))try{const e=await fetch("http://158.101.166.74:8080/api/data/yevhenii_zhyrov/events/"+n,{method:"DELETE"});if(!e.ok)try{const t=await e.statusText;return(0,s.Z)(`API: ${t}`,"error")}catch(e){console.log(e)}try{const n=await e.status;console.log(n),(0,s.Z)("API: event deleted succesfully","succesful"),t.remove()}catch(e){console.log(e)}}catch(e){console.log(e)}})),this.meetings=e,this.users=t,this.members=JSON.parse(localStorage.getItem("membersDB")),this.sessionUser=JSON.parse(sessionStorage.getItem("memberLoggedIn")),this.render()}async render(){const e=document.createElement("div");e.innerHTML=this.getTable();const t=e.firstElementChild;return this.element=t,this.meetings.length&&this.renderMeetings(this.meetings),this.subElements=this.getSubElements(this.element),this.initEventListeners(),this.element}getSubElements(e=this.element){return[...e.querySelectorAll("[data-meeting]")].reduce(((e,t)=>(e[t.dataset.meeting]=t,e)),{})}getTable(){return`\n      <div class='calendar'>\n        ${this.getTableHeader()}\n        ${this.getTableBody()}\n        ${this.getTableFooter()}\n        <div aria-live="polite" aria-atomic="true" class="position-relative">\n          <div class="toast-container position-fixed bottom-0 end-0 p-3">\n\n          </div>\n        </div>\n      </div>`}getTableFooter(){return`<div class='calendar__footer'>\n      <div>\n        You are logged in as ${this.sessionUser.name} (${this.sessionUser.rights})\n      </div>\n      <button type='button' class='btn btn-outline-secondary' id='logOutButton'>\n        Log out\n      </button>\n    </div>`}getTableHeader(){return`\n      <div class='calendar__header'>\n        <div>\n          <h1>Calendar</h1>\n        </div>\n        <div class='calendar__header_handling'>\n            ${this.getMembersDropdown()}\n            ${this.getEventButton}\n        </div>\n      </div>\n    `}getMembersDropdown(){return`\n    <div class='calendar__header_handling-dropdown'>\n      <select class='form-select form-select-lg' id='membersDropdown'>\n        <option value='All members'>All members</option>\n        ${this.membersList}\n      </select>\n    </div>`}get membersList(){return this.users.map((e=>`<option value='${e.data.name}' data-member='${e.data.name}'>${e.data.name}</option>`)).join("")}get getEventButton(){return this.canCreateMeetings()?"\n    <div class='calendar__header_handling-newEventCreatingButton'>\n      <a href='/meeting-planning-calendar/create-event'>\n        <button\n          type='submit'\n          name='newEvent'\n          class='btn btn-outline-dark'\n        >\n        New event +\n        </button>\n      </a>\n    </div>":"\n    <div class='calendar__header_handling-newEventCreatingButton'>\n        <button\n          type='submit'\n          name='newEvent'\n          class='btn btn-outline-dark disabled'\n        >\n        New event +\n        </button>\n    </div>"}getTableBody(){return`<div class='calendar__table'>\n      <ul class='calendar__table-column' data-day='Name'>\n        <li class='calendar__table-column-header'>Name</li>\n        ${this.getTableHoursColumn()}\n      </ul>\n\n      <ul class='calendar__table-column' data-day='Mon'>\n        <li class='calendar__table-column-header'>Mon</li>\n        ${this.getTableColumn()}\n      </ul>\n\n      <ul class='calendar__table-column' data-day='Tue'>\n        <li class='calendar__table-column-header'>Tue</li>\n        ${this.getTableColumn()}\n      </ul>\n\n      <ul class='calendar__table-column' data-day='Wed'>\n        <li class='calendar__table-column-header'>Wed</li>\n        ${this.getTableColumn()}\n      </ul>\n\n      <ul class='calendar__table-column' data-day='Thu'>\n        <li class='calendar__table-column-header'>Thu</li>\n        ${this.getTableColumn()}\n      </ul>\n\n      <ul class='calendar__table-column' data-day='Fri'>\n        <li class='calendar__table-column-header'>Fri</li>\n        ${this.getTableColumn()}\n      </ul>\n    </div>`}getTableHoursColumn(){let e=[];for(let t=this.start;t<=this.end;t+=this.duration)e.push(`<li>${t}:00</li>`);return e.join("")}getTableColumn(){let e=[];for(let t=this.start;t<=this.end;t+=this.duration)e.push(`<li\n          data-time='${t}:00'\n        ></li>`);return e.join("")}renderMeetings(e){[...e].map((e=>{const t=this.element.querySelector(`[data-day='${e.data.day}']`).querySelector(`[data-time='${e.data.time}']`);return this.canDeleteMeetings()?t.innerHTML=`\n      <div data-meeting='${e.id}' data-name='${e.data.name}' style='visibility: visible'>\n        <a href='/meetings/${e.id}' class='calendar__table-column_meeting'>\n          ${e.data.name}\n        </a>\n        <button class='calendar__table-column_meeting_delete' data-delete='delete'>&times;</button>\n      </div>`:t.innerHTML=`\n      <div data-meeting='${e.id}' data-name='${e.data.name}' style='visibility: visible'>\n        <div class='calendar__table-column_meeting'>\n          ${e.data.name}\n        </div>\n      </div>`}))}initEventListeners(){if(this.canDeleteMeetings()){const e=this.element.querySelectorAll("[data-delete]");for(let t of e)t.addEventListener("pointerdown",this.onRemoveMeetingClick)}const e=this.element.querySelector("#membersDropdown");e.addEventListener("change",(()=>{const t=e.value;this.filterMeetings(t)})),this.element.querySelector("#logOutButton").addEventListener("click",(()=>{sessionStorage.clear(),window.location.reload()}))}filterMeetings(e){if(!this.meetings.length)return(0,s.Z)("No events to filter","warning");if("All members"===e){for(let e of Object.keys(this.subElements))this.subElements[e].style.visibility="visible";return[...this.meetings]}const t=[...this.meetings],n=[...this.users].find((({data:t})=>t.name===e)).id,a=t.filter((e=>e.data.members.every((e=>e.id!==n)))).map((e=>e.id));for(let e of Object.keys(this.subElements))this.subElements[e].style.visibility="visible";for(let e of a)Object.keys(this.subElements).includes(e)&&(this.subElements[e].style.visibility="hidden");return a}destroy(){this.element.remove()}}{constructor(e,t){super(e,t)}canDeleteMeetings(){return!1}canCreateMeetings(){return!1}}class l extends i{constructor(e,t){super(e,t)}canDeleteMeetings(){return!0}canCreateMeetings(){return!0}}class o{constructor(e){this.members=e}get template(){return`\n    <div class="modal fade modal-dialog"  id="staticBackdrop">\n      <div class="modal-dialog">\n        <div class="modal-content">\n          <div class="modal-header">\n            <h5 class="modal-title" id="staticBackdropLabel">Who are You?</h5>\n          </div>\n          <div class="modal-body">\n            <div class='calendar__header_handling-dropdown'>\n              <select class='form-select form-select-lg' id='membersDropdownModal'>\n                ${this.members.map((e=>`<option value='${e.data.name}' data-rights='${e.data.rights}'>${e.data.name} (${e.data.rights})</option>`)).join("")}\n              </select>\n            </div>\n          </div>\n          <div class="modal-footer">\n            <button type="button" class="btn btn-secondary" id="submitRoleButton">Confirm</button>\n          </div>\n        </div>\n      </div>\n    </div>`}}function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const d="http://158.101.166.74:8080/api/data";class c{constructor(){r(this,"element",void 0),r(this,"subElements",{}),r(this,"components",{}),r(this,"meetings",{}),r(this,"users",{}),r(this,"onDefineRights",(()=>{const e=this.element.querySelector("#membersDropdownModal"),t=e.value,n=e.options[e.selectedIndex].getAttribute("data-rights"),s={name:t,rights:n};sessionStorage.setItem("memberLoggedIn",JSON.stringify(s)),document.querySelector("#staticBackdrop").remove(),document.querySelector(".modal-backdrop").remove(),this.initComponents(n),this.renderComponents()}))}get template(){return'\n      <div>\n        <div data-element="calendar" id="calendarPage">\n          \x3c!-- Calendar component --\x3e\n        </div>\n        <div aria-live="polite" aria-atomic="true" class="position-relative">\n          <div class="toast-container position-fixed bottom-0 end-0 p-3">\n\n          </div>\n        </div>\n      </div>\n    '}async getUsers(){try{const e=await fetch(`${d}/yevhenii_zhyrov/users`);if(!e.ok)try{const t=await e.statusText;return(0,s.Z)(`API: ${t}`,"error")}catch(e){console.log(e)}try{const t=await e.json();if(null===await t)return(0,s.Z)("API: no users","succesful");this.users=await t.map((e=>({id:e.id,data:JSON.parse(e.data)}))),setTimeout((()=>(0,s.Z)("API: users downloaded succesfully","succesful")),100)}catch(e){console.log(e)}}catch(e){console.log(e)}}async getData(){try{const e=await fetch(`${d}/yevhenii_zhyrov/events`);if(!e.ok)try{const t=await e.statusText;return(0,s.Z)(`API: ${t}`,"error")}catch(e){console.log(e)}try{const t=await e.json();if(null===await t)return(0,s.Z)("API: no events","warning");this.meetings=await t.map((e=>({id:e.id,data:JSON.parse(e.data)}))),setTimeout((()=>(0,s.Z)("API: data downloaded succesfully","succesful")),100)}catch(e){console.log(e)}}catch(e){console.log(e)}}async render(){const e=document.createElement("div");e.innerHTML=this.template,this.element=e.firstElementChild,this.subElements=this.getSubElements(this.element),await this.getData(),await this.getUsers();const t=JSON.parse(sessionStorage.getItem("memberLoggedIn"));return t?(this.initComponents(t.rights),this.renderComponents(),this.element):(this.modal(),this.element)}modal(){const e=new o(this.users);this.element.querySelector("#calendarPage").innerHTML=e.template,new bootstrap.Modal(this.element.querySelector("#staticBackdrop"),{}).show(),this.element.querySelector("#submitRoleButton").addEventListener("pointerdown",this.onDefineRights)}getSubElements(e){return[...e.querySelectorAll("[data-element]")].reduce(((e,t)=>(e[t.dataset.element]=t,e)),{})}initComponents(e){if("admin"===e){const e=new l(this.meetings,this.users);return this.components.calendar=e}const t=new i(this.meetings,this.users);return this.components.calendar=t}renderComponents(){Object.keys(this.components).forEach((e=>{const t=this.subElements[e],{element:n}=this.components[e];t.append(n)}))}destroy(){for(const e of Object.values(this.components))e.destroy()}}}}]);
//# sourceMappingURL=calendar-index-js.c7e0544ce220b66ba715.js.map