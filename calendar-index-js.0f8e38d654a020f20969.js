(self.webpackChunk=self.webpackChunk||[]).push([[849],{579:(e,t,n)=>{"use strict";n.d(t,{Z:()=>s});const s=(e="API response: succesful",t)=>{const n=`\n    <div class="toast calendar__toast_${t} align-items-center" role="alert" aria-live="assertive" aria-atomic="true">\n      <div class="d-flex">\n        <div class="toast-body">\n          ${e}\n        </div>\n      </div>\n    </div>`,s=document.querySelector(".toast-container"),a=document.createElement("div");a.innerHTML=n;const i=a.firstElementChild;s.appendChild(i);const r=s.lastElementChild;new bootstrap.Toast(r,{animation:!0,autohide:!0,delay:2e3}).show(),setTimeout((()=>{s.firstElementChild.remove()}),2e3)}},555:(e,t,n)=>{"use strict";n.d(t,{Z:()=>u});var s=n(579);class a extends Error{constructor(e,t){var n,s;super(t),s="FetchError",(n="name")in this?Object.defineProperty(this,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):this.name=s,this.response=e}}window.addEventListener("unhandledrejection",(e=>{e.reason instanceof a&&alert(e.reason.message)}));const i="http://158.101.166.74:8080/api/data",r="yevhenii_zhyrov";class o{static instance(){return this._instance||(this._instance=new o),this._instance}response(e,t){const n=new(0,o.response[e])(t);return n.type=e,n.define=(i=async function(){const e=await fetch(this.url,this.options);if(!e.ok){const t=`Error ${e.status}: ${e.statusText}`;return(0,s.Z)(`API: ${t}`,"error"),console.error(new FetchError(e,t)),e.ok}return this.getTry(e)},async function(...e){let t;try{return t=await i.apply(this,e),t}catch(e){e instanceof TypeError&&console.error(new a(t,e)),setTimeout((()=>{(0,s.Z)(`API: something went wrong with getting ${this.data}`,"error")}),100)}}),n;var i}}var l,d,c;l=o,d="response",c={get:class{constructor(e){this.data=e,this.message=`${e} downloaded`,"users"===e&&(this.url=`${i}/${r}/users`),"events"===e&&(this.url=`${i}/${r}/events`),this.options={method:"GET"}}async getTry(e){const t=await e.json(),n=await t.map((e=>({id:e.id,data:JSON.parse(e.data)})));return setTimeout((()=>(0,s.Z)(`API: ${this.message} succesfully`,"succesful")),100),n}},isTimeSlotEmpty:class{constructor(e){this.data=e,this.url=`${i}/${r}/events`,this.options={method:"GET"}}async getTry(e){const t=await e.json();return null===await t?((0,s.Z)("No data","warning"),!0):!await t.some((e=>JSON.parse(e.data).day===this.data.day&&JSON.parse(e.data).time===this.data.time))||((0,s.Z)("API: This time slot is already occupied. Please choose another day or time","warning"),!1)}},post:class{constructor(e){this.data=e,this.message=`${e} posted`,this.url=`${i}/${r}/events`,this.options={method:"POST",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify({data:JSON.stringify(e)})}}async getTry(){(0,s.Z)("API: event posted succesfully","succesful")}},put:class{constructor(e){this.data=e,this.url=`${i}/${r}/events/${e.id}`,this.options={method:"PUT",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify({data:JSON.stringify(e.data)})}}async getTry(){(0,s.Z)("API: event changed succesfully","succesful")}},delete:class{constructor(e){this.data=e,this.url=`${i}/${r}/events/`+e,this.options={method:"DELETE"}}async getTry(e){return setTimeout((()=>(0,s.Z)("API: event deleted succesfully","succesful")),100),e.ok}}},d in l?Object.defineProperty(l,d,{value:c,enumerable:!0,configurable:!0,writable:!0}):l[d]=c;const u=o.instance()},675:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>u});var s=n(555),a=n(579);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class r extends class{constructor(e,t){i(this,"element",void 0),i(this,"subElements",{}),i(this,"start",10),i(this,"end",18),i(this,"duration",1),i(this,"onRemoveMeetingClick",(async e=>{const t=e.target.closest("[data-meeting]"),n=t.dataset.meeting,a=t.dataset.name;if(confirm(`Are you sure you want to delete '${a}' event?`)){const e=await s.Z.response("delete",n);await e.define()&&t.remove()}})),this.meetings=e,this.users=t,this.sessionUser=JSON.parse(sessionStorage.getItem("memberLoggedIn")),this.render()}render(){const e=document.createElement("div");e.innerHTML=this.getTable();const t=e.firstElementChild;return this.element=t,this.meetings.length&&this.renderMeetings(this.meetings),this.subElements=this.getSubElements(this.element),this.initEventListeners(this.meetings),this.element}getSubElements(e=this.element){return[...e.querySelectorAll("[data-meeting]")].reduce(((e,t)=>(e[t.dataset.meeting]=t,e)),{})}getTable(){return`\n      <div class='calendar'>\n        ${this.getTableHeader()}\n        ${this.getTableBody()}\n        ${this.getTableFooter()}\n        <div aria-live="polite" aria-atomic="true" class="position-relative">\n          <div class="toast-container position-fixed bottom-0 end-0 p-3">\n\n          </div>\n        </div>\n      </div>`}getTableFooter(){return`<div class='calendar__footer'>\n      <div>\n        You are logged in as ${this.sessionUser.name} (${this.sessionUser.rights})\n      </div>\n      <button type='button' class='btn btn-outline-secondary' id='logOutButton'>\n        Log out\n      </button>\n    </div>`}getTableHeader(){return`\n      <div class='calendar__header'>\n        <div>\n          <h1>Calendar</h1>\n        </div>\n        <div class='calendar__header_handling'>\n            ${this.getMembersDropdown()}\n            ${this.getEventButton}\n        </div>\n      </div>\n    `}getMembersDropdown(){return"guest"===this.sessionUser.name?"\n      <div class='calendar__header_handling-dropdown'>\n        <select class='form-select form-select-lg' id='membersDropdown'>\n          <option value='All members'>All members</option>\n        </select>\n      </div>":`\n    <div class='calendar__header_handling-dropdown'>\n      <select class='form-select form-select-lg' id='membersDropdown'>\n        <option value='All members'>All members</option>\n        ${this.membersList}\n      </select>\n    </div>`}get membersList(){return this.users.map((e=>`<option value='${e.data.name}' data-member='${e.data.name}'>${e.data.name}</option>`)).join("")}get getEventButton(){return this.canCreateMeetings()?"\n    <div class='calendar__header_handling-newEventCreatingButton'>\n      <a href='meeting-planning-calendar/create-event'>\n        <button\n          type='submit'\n          name='newEvent'\n          class='btn btn-outline-dark'\n        >\n        New event +\n        </button>\n      </a>\n    </div>":"\n    <div class='calendar__header_handling-newEventCreatingButton'>\n        <button\n          type='submit'\n          name='newEvent'\n          class='btn btn-outline-dark disabled'\n        >\n        New event +\n        </button>\n    </div>"}getTableBody(){return`<div class='calendar__table'>\n      <ul class='calendar__table-column' data-day='Name'>\n        <li class='calendar__table-column-header'>Name</li>\n        ${this.getTableHoursColumn()}\n      </ul>\n\n      <ul class='calendar__table-column' data-day='Mon'>\n        <li class='calendar__table-column-header'>Mon</li>\n        ${this.getTableColumn("Mon")}\n      </ul>\n\n      <ul class='calendar__table-column' data-day='Tue'>\n        <li class='calendar__table-column-header'>Tue</li>\n        ${this.getTableColumn("Tue")}\n      </ul>\n\n      <ul class='calendar__table-column' data-day='Wed'>\n        <li class='calendar__table-column-header'>Wed</li>\n        ${this.getTableColumn("Wed")}\n      </ul>\n\n      <ul class='calendar__table-column' data-day='Thu'>\n        <li class='calendar__table-column-header'>Thu</li>\n        ${this.getTableColumn("Thu")}\n      </ul>\n\n      <ul class='calendar__table-column' data-day='Fri'>\n        <li class='calendar__table-column-header'>Fri</li>\n        ${this.getTableColumn("Fri")}\n      </ul>\n    </div>`}getTableHoursColumn(){let e=[];for(let t=this.start;t<=this.end;t+=this.duration)e.push(`<li>${t}:00</li>`);return e.join("")}getTableColumn(e){let t=[];for(let n=this.start;n<=this.end;n+=this.duration)t.push(`<li\n          data-time='${n}:00'\n          data-day='${e}'\n        ></li>`);return t.join("")}renderMeetings(e){[...e].map((e=>{const t=this.element.querySelector(`[data-day='${e.data.day}']`).querySelector(`[data-time='${e.data.time}']`);return this.canDeleteMeetings()?t.innerHTML=`\n      <div draggable='true' data-meeting='${e.id}' data-meetingDay='${e.data.day}' data-meetingTime='${e.data.time}' style='visibility: visible'>\n          <div class='calendar__table-column_meeting'>\n            ${e.data.name}\n          </div>\n        <button class='calendar__table-column_meeting_delete' data-delete='delete'>&times;</button>\n      </div>`:t.innerHTML=`\n      <div data-meeting='${e.id}' data-name='${e.data.name}' style='visibility: visible'>\n        <div class='calendar__table-column_meeting'>\n          ${e.data.name}\n        </div>\n      </div>`}))}dragAndDropEvents(e){let t;document.addEventListener("dragstart",(function(e){t=e.target,e.target.style.opacity=.5})),document.addEventListener("dragend",(function(e){e.target.style.opacity=""})),document.addEventListener("dragover",(function(e){e.preventDefault()})),document.addEventListener("dragenter",(function(e){e.target.dataset.time&&(e.target.style.background="purple")})),document.addEventListener("dragleave",(function(e){e.target.dataset.time&&(e.target.style.background="")})),document.addEventListener("drop",(function(n){if(n.preventDefault(),n.target.dataset.time){n.target.style.background="",t.parentNode.removeChild(t),n.target.appendChild(t);const a=t.dataset.meeting,i=n.target.dataset.day,r=n.target.dataset.time,o=[...e].find((({id:e})=>e===a));o.data.day=i,o.data.time=r,async function(e){const t=await s.Z.response("put",e);await t.define()}(o)}}))}initEventListeners(e){if(this.dragAndDropEvents(e),this.canDeleteMeetings()){const e=this.element.querySelectorAll("[data-delete]");for(let t of e)t.addEventListener("pointerdown",this.onRemoveMeetingClick)}const t=this.element.querySelector("#membersDropdown");t.addEventListener("change",(()=>{const e=t.value;this.filterMeetings(e)})),this.element.querySelector("#logOutButton").addEventListener("click",(()=>{sessionStorage.clear(),window.location.reload()}))}filterMeetings(e){if(!this.meetings.length)return(0,a.Z)("No events to filter","warning");if("All members"===e){for(let e of Object.keys(this.subElements))this.subElements[e].style.visibility="visible";return[...this.meetings]}const t=[...this.meetings],n=[...this.users].find((({data:t})=>t.name===e)).id,s=t.filter((e=>e.data.members.every((e=>e.id!==n)))).map((e=>e.id));for(let e of Object.keys(this.subElements))this.subElements[e].style.visibility="visible";for(let e of s)Object.keys(this.subElements).includes(e)&&(this.subElements[e].style.visibility="hidden");return s}destroy(){this.element.remove()}}{constructor(e,t){super(e,t)}canDeleteMeetings(){return!1}canCreateMeetings(){return!1}}class o extends r{constructor(e,t){super(e,t)}canDeleteMeetings(){return!0}canCreateMeetings(){return!0}}class l{constructor(e){this.members=e}get template(){return`\n    <div class="modal fade modal-dialog"  id="staticBackdrop">\n      <div class="modal-dialog">\n        <div class="modal-content">\n          <div class="modal-header">\n            <h5 class="modal-title" id="staticBackdropLabel">Who are You?</h5>\n          </div>\n          <div class="modal-body">\n            <div class='calendar__header_handling-dropdown'>\n              <select class='form-select form-select-lg' id='membersDropdownModal'>\n                ${this.members.map((e=>`<option value='${e.data.name}' data-rights='${e.data.rights}'>${e.data.name} (${e.data.rights})</option>`)).join("")}\n              </select>\n            </div>\n          </div>\n          <div class="modal-footer">\n            <button type="button" class="btn btn-secondary" id="submitRoleButton">Confirm</button>\n          </div>\n        </div>\n      </div>\n    </div>`}}const d=[{id:"0000",data:{name:"guest",rights:"user"}}];function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class u{constructor(){c(this,"element",void 0),c(this,"subElements",{}),c(this,"components",{}),c(this,"meetings",{}),c(this,"users",{}),c(this,"onDefineRights",(()=>{const e=this.element.querySelector("#membersDropdownModal"),t=e.value,n=e.options[e.selectedIndex].getAttribute("data-rights"),s={name:t,rights:n};sessionStorage.setItem("memberLoggedIn",JSON.stringify(s)),document.querySelector("#staticBackdrop").remove(),document.querySelector(".modal-backdrop").remove(),this.initComponents(n),this.renderComponents()}))}get template(){return'\n      <div>\n        <div data-element="calendar" id="calendarPage">\n          \x3c!-- Calendar component --\x3e\n        </div>\n        <div aria-live="polite" aria-atomic="true" class="position-relative">\n          <div class="toast-container position-fixed bottom-0 end-0 p-3">\n\n          </div>\n        </div>\n      </div>\n    '}async render(){const e=document.createElement("div");e.innerHTML=this.template,this.element=e.firstElementChild,this.subElements=this.getSubElements(this.element);const t=await s.Z.response("get","users"),n=await s.Z.response("get","events");this.users=await t.define()||d,this.meetings=await n.define()||[];const a=JSON.parse(sessionStorage.getItem("memberLoggedIn"));return a?(this.initComponents(a.rights),this.renderComponents(),this.element):(this.modal(),this.element)}modal(){const e=new l(this.users);this.element.querySelector("#calendarPage").innerHTML=e.template,new bootstrap.Modal(this.element.querySelector("#staticBackdrop"),{}).show(),this.element.querySelector("#submitRoleButton").addEventListener("pointerdown",this.onDefineRights)}getSubElements(e){return[...e.querySelectorAll("[data-element]")].reduce(((e,t)=>(e[t.dataset.element]=t,e)),{})}initComponents(e){if("admin"===e){const e=new o(this.meetings,this.users);return this.components.calendar=e}const t=new r(this.meetings,this.users);return this.components.calendar=t}renderComponents(){Object.keys(this.components).forEach((e=>{const t=this.subElements[e],{element:n}=this.components[e];t.append(n)}))}destroy(){for(const e of Object.values(this.components))e.destroy()}}}}]);
//# sourceMappingURL=calendar-index-js.0f8e38d654a020f20969.js.map